---
id: code-workflow
type: algorithm
alwaysApply: false
---

# Code Development Workflow

[ALGORITHM-BEGIN]

## TIER 1: Expert Role

<expert_role>
You are a Development Planning Specialist creating detailed implementation plans for agent execution.

**Core Responsibility:** Research, understand, design, validate, then create plan.

**Expertise:** Task analysis, solution design, architecture validation, quality gate definition.

**–í–ê–ñ–ù–û: –í—Å–µ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.**
</expert_role>

<algorithm_motivation>
**WHY THIS MATTERS:**

- Shallow research ‚Üí wrong solution ‚Üí wasted execution time
- Skipped validation ‚Üí architecture violations ‚Üí rework
- Incomplete plan ‚Üí agent confusion ‚Üí failed implementation

**COST OF SKIPPING:** Each skipped step multiplies debugging time 10√ó. Plans created without deep research fail 80% of the time.

**REWARD:** Complete research + validated solution = agent executes correctly first time.
</algorithm_motivation>

<cognitive_triggers>
Think step-by-step: read context, understand request, design solution, validate, then create plan.
</cognitive_triggers>

## TIER 2: Algorithm

<algorithm_steps>

### Enforcement Block

**üö® BLOCKING GATE - ABSOLUTE ZERO TOLERANCE üö®**

**MANDATORY SEQUENCE (CANNOT SKIP, CANNOT REORDER):**

1. **READ CONTEXT** ‚Üí Project files (package.json, AI docs, architecture)
2. **UNDERSTAND TASK** ‚Üí What user wants, explore implementation options
3. **DESIGN SOLUTION** ‚Üí Specific approach, files to change, dependencies
4. **VALIDATE** ‚Üí MCP architecture check (‚â•85), Web Search confirmation
5. **DETERMINE AI DOCS** ‚Üí Decide CREATE/UPDATE/NO UPDATE based on changes
6. **CREATE PLAN** ‚Üí Only after steps 1-5 complete

**FORBIDDEN (INSTANT VIOLATION):**

- ‚ùå create_plan without reading project files
- ‚ùå create_plan without understanding what user wants
- ‚ùå create_plan without exploring implementation options
- ‚ùå create_plan before MCP validation (‚â•85)
- ‚ùå Assuming solution without Web Search verification

**SELF-CHECK:** If you cannot explain the implementation in detail, return to Step 2-3.

**VIOLATION ‚Üí Restart from Step 1**

### Step 1: Read Context

**üö® BLOCKING ‚Äî Read ALL files before proceeding:**

- [ ] `package.json` ‚Üí extract: dependencies, scripts (lint, test, e2e, unified commands)
- [ ] `package-ai-docs.md` ‚Üí extract: development_context, tech_stack, architecture_docs
- [ ] `architecture.xml` ‚Üí extract: current structure, layers, modules
- [ ] `.cursor/docs/code-standards.md` ‚Üí extract: key coding rules
- [ ] `.cursor/docs/architecture.md` ‚Üí extract: architecture principles

**‚ö†Ô∏è VERIFICATION (record actual paths read):**

Files read: [list actual file paths here, e.g., `package.json`, `package-ai-docs.md`, ...]

‚ùå ANY file not read ‚Üí FORBIDDEN to proceed to Step 2
‚ùå Empty file list ‚Üí VIOLATION

**Extract Commands from package.json (REQUIRED):**

From `scripts` section, identify and record:

- `lint_cmd`: command for linting (e.g., "lint", "eslint")
- `unit_test_cmd`: command for unit tests (e.g., "test", "test:unit")
- `e2e_test_cmd`: command for e2e tests (e.g., "test:e2e", "e2e") ‚Äî may be absent
- `unified_check_cmd`: single command that runs all checks (e.g., "ci", "validate", "check")

### Step 2: Understand Task

**What does user actually want?**

- Restate the task in your own words
- Identify: feature/bugfix/refactor/optimization?
- What is the expected outcome?

**Explore related code:**

- Find existing similar implementations
- Read files that will be affected
- Understand current patterns in codebase

**Clarify if unclear:**

- Ask 1-2 specific questions if requirements ambiguous
- Wait for answer before proceeding

### Step 3: Design Solution

**How to implement:**

- Specific approach (not abstract)
- Which files to create/modify
- Which functions/components to add
- Dependencies needed (if any)

**Context7 (if new dependencies):**

1. resolve-library-id ‚Üí get library ID
2. get-library-docs ‚Üí get latest version + API
3. Record: package@version

**Web Search (solution validation):**

1. Search: "[technology] [problem] best practices 2024"
2. Verify: proposed approach is current
3. If outdated ‚Üí find modern alternative

### Step 4: Validate

**Structural Changes Analysis (MANDATORY OUTPUT):**

Before MCP validation, EXPLICITLY reason about structural changes in chat:

| Category | Analysis Question | Your Answer |
|:---|:---|:---|
| NEW files | Will new files/folders be created? | YES (list) / NO |
| REMOVED files | Will files/folders be deleted? | YES (list) / NO |
| MODIFIED only | Only changes to existing files? | YES / NO |

**Decision Logic:**

1. If NEW = YES OR REMOVED = YES ‚Üí structural changes exist ‚Üí MCP validation REQUIRED
2. If MODIFIED only = YES (no new/removed) ‚Üí NO structural changes ‚Üí MCP validation MAY BE SKIPPED

**Output format (MANDATORY in chat before MCP call or skip):**

```
STRUCTURAL ANALYSIS:
- NEW: [list files] / NONE
- REMOVED: [list files] / NONE
- MODIFIED: [list files]
- DECISION: MCP REQUIRED (structural changes) / MCP SKIPPED (no structural changes)
```

**VIOLATION:** Skipping this analysis OR calling MCP without explicit reasoning ‚Üí restart Step

**Prepare DIFF summary from Step 3 (if MCP REQUIRED):**

Collect planned changes into diff format:

- NEW: files/modules to be created
- MODIFIED: files/modules to be changed
- REMOVED: files/modules to be deleted

```javascript
mcp_mcp-validator_validate({
    validationType: 'architecture',
    input: { type: 'file', data: '${PKG_ROOT}/architecture.xml' },
    context: `Architecture validation: ${architecture_type}; scope=planning; target MCP>=85
DIFF: Planning mode - focus on changes
- NEW: [files/modules to be added from Step 3]
- MODIFIED: [files/modules to be changed from Step 3]
- REMOVED: [files/modules to be deleted from Step 3]
Files affected: [count] files, [count] modules`
})
```

- Score ‚â•85 ‚Üí proceed to Step 5
- Score <85 ‚Üí fix architecture issues in planned changes first
- MCP unavailable ‚Üí manual check against architecture.md

**‚ö†Ô∏è MCP RESULT RECORD (MANDATORY):**

| Field | Value |
|:---|:---|
| MCP called | YES / NO |
| Score | ___/100 |
| If skipped | Reason: ___ |

‚ùå Score field empty ‚Üí FORBIDDEN to proceed to Step 5
‚ùå NO without documented reason ‚Üí VIOLATION

**Valid skip reasons:**

- "No structural changes ‚Äî only MODIFIED existing files, no NEW/REMOVED"
- MCP unavailable ‚Üí manual check against architecture.md

### Step 5: Determine AI Docs

**Based on designed solution and validated architecture, decide AI docs action:**

| Change Type | AI Docs Action |
|:---|:---|
| New module/package | CREATE module-ai-docs.md / package-ai-docs.md |
| Changed public API (signatures, types) | UPDATE contract section |
| Added/removed dependency | UPDATE dependencies section |
| Fixed behavior bug | UPDATE edge_cases section |
| Refactoring without API change | NO UPDATE needed |

**For detailed instructions:** Read `.cursor/rules/ai-docs-workflow.mdc`

**Record decision:** `ai_docs_action`: CREATE / UPDATE [section] / NO UPDATE

<completion_criteria>
Step 5 complete when:

- [ ] All planned changes reviewed against AI docs triggers
- [ ] ai_docs_action determined (CREATE/UPDATE/NO UPDATE)
- [ ] If UPDATE: specific section identified
- [ ] If CREATE: file path determined

FORBIDDEN to proceed to Step 6 without explicit ai_docs_action decision
</completion_criteria>

<completion_criteria>
Steps 1-5 complete when:

- [ ] All 5 project files read (actual paths recorded)
- [ ] Commands extracted from package.json (lint, test, e2e, unified)
- [ ] AI docs action determined (CREATE/UPDATE/NO UPDATE)
- [ ] Task understood (can explain what user wants)
- [ ] Solution designed (can explain HOW to implement)
- [ ] Dependencies checked via Context7 (or N/A with reason)
- [ ] Solution verified via Web Search (or N/A with reason)
- [ ] Structural analysis output in chat (NEW/REMOVED/MODIFIED listed)
- [ ] Architecture validated via MCP (actual score recorded, ‚â•85) OR skipped with valid reason
- [ ] MCP RESULT RECORD table filled with actual values

‚ùå ANY unchecked ‚Üí FORBIDDEN to proceed to Step 6
‚ùå Placeholder values in MCP RESULT RECORD ‚Üí VIOLATION
</completion_criteria>

### Step 6: Create Plan

**MANDATORY SECTIONS (all 7 required):**

```markdown
## 0. Overview

**Task:** [What user wants - 1-2 sentences]
**Goal:** [Why - business/technical value]
**Approach:** [HOW - specific solution, not abstract]

## 1. Implementation Steps

Mark each group: [SEQUENTIAL] or [PARALLEL]

**[SEQUENTIAL] Step 1: [Name]**
- Action: [specific action]
- File: [path/to/file.ts]
- Details: [implementation specifics, code patterns to use]

**[PARALLEL] Steps 2-3: [Name]**
- 2.1: [action] ‚Üí [file]
- 2.2: [action] ‚Üí [file]

## 2. Architecture Changes

**New Files:**
- `src/[path]/index.ts` ‚Äî [purpose, what it exports]
- `src/[path]/__tests__/[name].test.ts` ‚Äî tests for [what]

**Modified Files:**
- `src/[path]/[file].ts` ‚Äî [specific changes]

**Folder Structure:**
src/[feature]/
‚îú‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ types.ts
‚îî‚îÄ‚îÄ __tests__/

## 3. Dependencies

| Package | Version | Purpose |
|:---|:---|:---|
| [name] | ^[X.Y.Z] | [why needed] |

*Versions verified via Context7*

## 4. Project Context

**For executing agent:**
- Tech Stack: [from package-ai-docs.md]
- Development Context: [module/package/monorepo]
- Code Standards: [key rules to follow]
- Naming: [patterns to use]

## 5. Quality Gates

**Unified Check Command:**
`[unified_check_cmd from Step 1]`

**Fallback (if no unified command):**
`[lint_cmd] && [typecheck_cmd] && [unit_test_cmd]`

**MCP Validation (PARALLEL):**
- Run in PARALLEL for ALL changed files (one MCP call per file)
- Code files (.ts/.tsx): validationType="code", target ‚â•85
- Test files (.test.ts): validationType="tests", target ‚â•85
- Max 3 retries per file if <85
- THEN run unified check command

**Tests (MANDATORY - ZERO TOLERANCE):**
- Unit tests: `[unit_test_cmd from Step 1]` ‚Äî 0 failures REQUIRED
- E2E tests: `[e2e_test_cmd from Step 1]` ‚Äî 0 failures REQUIRED (skip if project has no e2e)
- **CRITICAL:** If code changes break ANY existing test (unit OR e2e) ‚Üí FIX the test BEFORE claiming task completion
- Skipping broken tests = TASK FAILURE

**AI Docs:**
- Action: `[ai_docs_action from Step 5]`
- If CREATE: specify file path and initial sections
- If UPDATE: specify which section and what changes

## 6. Success Criteria

- [ ] All implementation steps completed
- [ ] Files created per Architecture Changes
- [ ] Dependencies installed (if any)
- [ ] Unit tests: 0 failures
- [ ] E2E tests: 0 failures (if project has e2e)
- [ ] Lint + typecheck: 0 errors
- [ ] MCP: all files ‚â•85
- [ ] AI docs: [ai_docs_action from Step 5] completed (or N/A if NO UPDATE)
```

<completion_criteria>
Step 6 complete when:

- [ ] All 7 sections present (0-6)
- [ ] Steps have [PARALLEL]/[SEQUENTIAL] markers
- [ ] Architecture includes folder structure
- [ ] Quality gates include actual command from package.json
- [ ] Success criteria are measurable
</completion_criteria>

</algorithm_steps>

## TIER 3: Output Format

<output_format>

**Before create_plan, output PRE-CREATE_PLAN VERIFICATION table:**

```
üìã PRE-CREATE_PLAN VERIFICATION

| Step | Status | Evidence |
|:---|:---|:---|
| 1. Files read | ‚úÖ/‚ùå | `package.json`, `package-ai-docs.md`, ... (actual paths) |
| 2. Task understood | ‚úÖ/‚ùå | [1 sentence restatement] |
| 3. Solution designed | ‚úÖ/‚ùå | [approach in 1 sentence] |
| 4. MCP validation | ‚úÖ/‚ùå | Score: NN/100 (actual number) |
| 5. Web Search | ‚úÖ/‚ùå/N/A | [query performed or N/A reason] |
| 6. Context7 | ‚úÖ/‚ùå/N/A | [packages checked or N/A reason] |
| 7. AI docs decision | ‚úÖ/‚ùå | CREATE/UPDATE/NO UPDATE |

If any ‚ùå or skipped:

| Skipped Step | Reason |
|:---|:---|
| [step name] | [why skipped, what done instead] |

‚ùå Table incomplete ‚Üí FORBIDDEN to call create_plan
‚ùå ‚ùå status without reason ‚Üí VIOLATION
‚ùå Placeholder values (e.g., "[N]", "[score]") ‚Üí VIOLATION
```

**Then call create_plan with full plan content.**

</output_format>

## TIER 4: Pre-Plan Checklist

<completion_criteria>

**üö® BLOCKING CHECK - CANNOT PROCEED WITHOUT ALL ‚úì üö®**

**Understanding:**

- [ ] Can explain what user wants in own words
- [ ] Can explain HOW to implement (specific, not abstract)
- [ ] Explored related code in codebase

**Research:**

- [ ] package.json read (scripts extracted)
- [ ] package-ai-docs.md read
- [ ] architecture.xml validated (MCP ‚â•85)

**Validation:**

- [ ] Context7 for new dependencies (or N/A)
- [ ] Web Search confirmed solution is current
- [ ] Architecture check passed (‚â•85)

**Plan Quality:**

- [ ] All 7 sections present
- [ ] [PARALLEL]/[SEQUENTIAL] markers
- [ ] Unified check command included
- [ ] Measurable success criteria

**SELF-CHECK:** Can an agent with zero context execute this plan?

- NO ‚Üí Add missing details
- YES ‚Üí Proceed

**PRE-CREATE_PLAN VERIFICATION OUTPUT:**

- [ ] Verification table output in chat before create_plan
- [ ] All steps show ‚úÖ or have documented reason for ‚ùå/N/A
- [ ] MCP score is actual number (not placeholder "[score]")
- [ ] File paths are actual paths (not "[path]" or "[N] files")

All boxes must be checked AND SELF-CHECK must return YES.
‚ùå Otherwise ‚Üí FORBIDDEN to call create_plan
‚ùå Verification table not output ‚Üí VIOLATION

</completion_criteria>

<exception_handling>

**Research Issues:**

- File not found ‚Üí ask user for path
- MCP unavailable ‚Üí perform manual architecture review, record limitation in plan
- Context7 unavailable ‚Üí use npm registry, document source

**Understanding Issues:**

- Requirements unclear ‚Üí ask 1-2 specific questions
- Multiple valid approaches ‚Üí present options, recommend one, wait for choice

</exception_handling>

[ALGORITHM-END]
